<h3>商品名で検索する</h3>
<%= form_with url: search_path, method: :get, local:true do |f| %>
  <%= f.text_field 'search[value]', placeholder: "商品名を入力" %>
  <%= f.hidden_field 'search[model]', value: "product" %>
  <%= f.submit "商品検索", class: "btn btn-outline-success" %>
<% end %>
<h3>カテゴリーから検索する</h3>
<% @genres.each do |genre| %>
  <%= link_to genre.name, search_path('search[how]': "match", 'search[model]': "genre", 'search[value]': genre, genre_id: genre.id) %>
<% end %>
<h3>タグから検索する</h3>
<% @tags.each do |tag| %>
  <%= link_to tag.name, search_path('search[how]': "match", 'search[model]': "tag", 'search[value]': tag, tag_id: tag.id) %>
<% end %>
<p>※最近登録された順に20件表示しています。</p>
<h3>カテゴリー別評価ランキング</h3>
<table>
  <thead>
    <tr>
      <th>機器名</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>
        <% @genre_rankings.each do |genre| %>
          <%= genre.name %>のランキング<br>
          <% genre.products.each do |product| %>
            <%= link_to product.full_name, product_path(product) %>
            <%= image_tag product.image.variant(resize:'100x100') %>
            <div class="review-average" data-score=<%= product.review_average %>></div><%= product.review_average.round(1) %><br>
          <% end %>
        <% end %>
      </th>
    </tr>
  </tbody>
</table>


<script>
  $('.review-average').empty();
    $('.review-average').raty({
      readOnly: true,
      score: function() {
        return $(this).attr('data-score');
      },
      path: '/assets/'
    });
</script>